import{j as e,r as T,q as M,W as S}from"./app-Bgn0t0R-.js";import{B as A}from"./BreadCrumb-x5KN-Bdz.js";import{f as L,E as H}from"./EventDetailPanel-PqP8SKMs.js";import{U as K}from"./UserLayout-BpOd_NUI.js";import{g as N}from"./getDatePart-HgEJ48wy.js";import{g as E}from"./getDistance-Dm5tcyCK.js";import{N as $}from"./notification-D8nuFN0y.js";import{s as W}from"./showConfirmation-2MnBgizT.js";import{t as Z}from"./timeToSeconds-hLgWVabV.js";function v({type:i,id:s,name:a,value:r,handleChange:m,title:u,userType:t,index:o=null,ticketID:d=null,error:p=null}){const n=l=>{t==="pembeli"?m(l,"data_pembeli"):m(l,"data_pengunjung",o,d)},g=()=>p?"border border-red-500 focus:border-red-500 focus:ring-0 error-field":"border border-gray-300 focus:ring-teal-500 focus:border-teal-500";return e.jsxs("div",{children:[e.jsx("label",{htmlFor:s,className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:u}),e.jsx("input",{type:i,id:s,name:a,value:r,onChange:l=>n(l),className:`${g()} text-gray-900 text-sm rounded-lg block w-full p-2.5`}),i==="email"&&s==="email"&&e.jsx("span",{className:"text-xs poppins-medium text-teal-700 mt-2 block",children:"Email ini digunakan untuk mengirim E-Ticket"}),p&&e.jsx("span",{className:"text-sm poppins-medium text-red-600 mt-2 block",children:p})]})}function P({date:i,month:s,year:a,handleChange:r,userType:m,index:u=null,ticketID:t=null,error:o={date:null,month:null,year:null}}){const d=l=>{m==="pembeli"?r(l,"data_pembeli"):r(l,"data_pengunjung",u,t)},p=()=>o.date?"border border-red-500 focus:border-red-500 focus:ring-0 error-field":"border border-gray-300 focus:ring-teal-500 focus:border-teal-500",n=()=>o.month?"border border-red-500 focus:border-red-500 focus:ring-0 error-field":"border border-gray-300 focus:ring-teal-500 focus:border-teal-500",g=()=>o.year?"border border-red-500 focus:border-red-500 focus:ring-0 error-field":"border border-gray-300 focus:ring-teal-500 focus:border-teal-500";return e.jsxs("div",{children:[e.jsx("label",{htmlFor:"date",className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:"Tanggal Lahir"}),e.jsxs("div",{className:"grid grid-cols-3 gap-5",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("select",{id:"date",name:"date",value:i,onChange:l=>d(l),className:`bg-gray-50 text-gray-900 text-sm rounded-lg  block w-full p-2.5 ${p()}`,children:[e.jsx("option",{value:"",children:"Tanggal"}),Array.from({length:31},(l,c)=>e.jsx("option",{value:String(c+1).padStart(2,"0"),children:String(c+1).padStart(2,"0")},c))]}),o.date&&e.jsx("p",{className:"text-red-600 text-sm",children:o.date})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("select",{id:"month",name:"month",value:s,onChange:l=>d(l),className:`h-fit bg-gray-50 text-gray-900 text-sm rounded-lg  block w-full p-2.5 ${n()}`,children:[e.jsx("option",{value:"",children:"Bulan"}),Array.from({length:12},(l,c)=>e.jsx("option",{value:String(c+1).padStart(2,"0"),children:String(c+1).padStart(2,"0")},c))]}),o.month&&e.jsx("p",{className:"text-red-600 text-sm",children:o.month})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("select",{id:"year",name:"year",value:a,onChange:l=>d(l),className:`h-fit bg-gray-50 text-gray-900 text-sm rounded-lg  block w-full p-2.5 ${g()}`,children:[e.jsx("option",{value:"",children:"Tahun"}),Array.from({length:100},(l,c)=>e.jsx("option",{value:String(2024-c),children:2024-c},c))]}),o.year&&e.jsx("p",{className:"text-red-600 text-sm",children:o.year})]})]})]})}function C({gender:i,handleChange:s,index:a=null,ticketID:r=null,userType:m,name:u,idFemale:t,idMale:o,error:d=null}){const p=l=>{m==="pembeli"?s(l,"data_pembeli"):s(l,"data_pengunjung",a,r,"gender")},n=()=>d?"border border-red-500 error-field":"border border-gray-300",g=l=>i===l;return e.jsxs("div",{children:[e.jsx("label",{htmlFor:"gender",className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:"Jenis Kelamin"}),e.jsxs("div",{className:"grid grid-cols-2 gap-5",children:[e.jsxs("div",{className:`flex items-center ps-4 rounded ${n()}`,children:[e.jsx("input",{id:o,type:"radio",value:"Laki-laki",name:u,checked:g("Laki-laki"),onChange:l=>p(l),className:"w-4 h-4 text-teal-600 bg-gray-100 border-gray-300 focus:ring-teal-500 dark:focus:ring-teal-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"}),e.jsx("label",{htmlFor:o,className:"w-full py-4 ms-2 text-sm font-medium text-gray-900 dark:text-gray-300",children:"Laki-laki"})]}),e.jsxs("div",{className:`flex items-center ps-4 rounded ${n()}`,children:[e.jsx("input",{id:t,type:"radio",value:"Perempuan",name:u,checked:g("Perempuan"),onChange:l=>p(l),className:"w-4 h-4 text-teal-600 bg-gray-100 border-gray-300 focus:ring-teal-500 dark:focus:ring-teal-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"}),e.jsx("label",{htmlFor:t,className:"w-full py-4 ms-2 text-sm font-medium text-gray-900 dark:text-gray-300",children:"Perempuan"})]})]}),d&&e.jsx("span",{className:"text-sm text-red-600 block mt-2",children:d})]})}function I({identity_type:i,identity_number:s,handleChange:a,userType:r,index:m=null,ticketID:u=null,error:t={identity_type:null,identity_number:null}}){const o=n=>{r==="pembeli"?a(n,"data_pembeli"):a(n,"data_pengunjung",m,u)},d=()=>t.identity_type?"border border-red-500 focus:border-red-500 focus:ring-0 error-field":"border border-gray-300 focus:ring-teal-500 focus:border-teal-500",p=()=>t.identity_number?"border border-red-500 focus:border-red-500 focus:ring-0 error-field":"border border-gray-300 focus:ring-teal-500 focus:border-teal-500";return e.jsxs("div",{children:[e.jsx("label",{htmlFor:"identity-type",className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:"Nomor Identitas"}),e.jsxs("div",{className:"flex mb-2",children:[e.jsxs("select",{id:"identity-type",name:"identity_type",value:i,onChange:n=>o(n),className:`poppins-medium bg-gray-100 rounded-s-lg text-gray-900 text-sm block p-2.5 ${d()}`,children:[e.jsx("option",{value:"",children:"Pilih Identitas"}),e.jsx("option",{value:"KTP",children:"KTP"}),e.jsx("option",{value:"SIM",children:"SIM"}),e.jsx("option",{value:"PASSPORT",children:"Passport"})]}),e.jsx("input",{type:"number",id:"identity-number",name:"identity_number",value:s,onChange:n=>o(n),className:`poppins-medium bg-gray-50 w-full text-gray-900 text-sm block p-2.5 ${p()}`})]}),t.identity_number&&e.jsx("p",{className:"text-sm text-red-600",children:t.identity_number}),t.identity_type&&e.jsx("p",{className:"text-sm text-red-600",children:t.identity_type})]})}function q({data_pembeli:i,handleChange:s,errors:a}){return e.jsxs("div",{className:"border border-teal-700 text-white rounded-md shadow-md overflow-hidden",children:[e.jsx("div",{className:"p-5 bg-gradient-to-r from-teal-400 to-teal-500",children:e.jsx("span",{className:"text-center block",children:"Detail Pembeli"})}),e.jsxs("div",{className:"p-5 flex flex-col gap-4",children:[e.jsx(v,{id:"email",type:"email",name:"email",value:i.email,title:"Email",handleChange:s,userType:"pembeli",error:a["data_pembeli.email"]}),e.jsx(v,{id:"name",type:"text",name:"name",value:i.name,title:"Nama",handleChange:s,userType:"pembeli",error:a["data_pembeli.name"]}),e.jsx(P,{date:i.date,month:i.month,year:i.year,handleChange:s,userType:"pembeli",error:{date:a["data_pembeli.date"],month:a["data_pembeli.month"],year:a["data_pembeli.year"]}}),e.jsx(C,{gender:i.gender,handleChange:s,name:"gender",userType:"pembeli",idFemale:"gender-female",idMale:"gender-male",error:a["data_pembeli.gender"]}),e.jsx(I,{identity_type:i.identity_type,identity_number:i.identity_number,handleChange:s,userType:"pembeli",error:{identity_type:a["data_pembeli.identity_type"],identity_number:a["data_pembeli.identity_number"]}})]})]})}function R({ticket:i}){return e.jsxs("div",{className:"bg-gray-50 p-4 border border-teal-700 flex justify-between items-center rounded-md shadow-md",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h1",{className:"text-gray-500 text-sm poppins-medium",children:"Kategori Tiket"}),e.jsx("span",{className:"text-black poppins-medium mt-[3px]",children:i.name})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h1",{className:"text-gray-500 text-sm poppins-medium text-right",children:"Harga"}),e.jsx("span",{className:"text-black poppins-medium mt-[3px]",children:L(i.price)})]})]})}function U({index:i,ticketID:s,samakanDataPembeli:a}){return e.jsx("span",{className:"text-center block",children:e.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",value:"",className:"sr-only peer samakan-data-pembeli",name:`samakan-data-pembeli[${i}]`,onChange:r=>a(r,i,s)}),e.jsx("div",{className:"shadow-md relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-teal-300 dark:peer-focus:ring-teal-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:w-5 after:h-5 after:transition-all dark:border-gray-600 peer-checked:bg-teal-600"}),e.jsx("span",{className:"ms-3 text-sm font-medium text-white dark:text-gray-300",children:"Samakan dengan data pembeli"})]})})}function G({tickets:i,samakanDataPembeli:s,data_pengunjung:a,handleChange:r,errors:m}){return e.jsx(e.Fragment,{children:i.map((u,t)=>{var o,d,p,n,g,l,c,h;return e.jsxs("div",{className:"border border-teal-700 text-white rounded-md shadow-md overflow-hidden pengunjung",children:[e.jsxs("div",{className:"p-5 flex justify-between items-center bg-gradient-to-r from-teal-400 to-teal-500",children:[e.jsxs("span",{className:"text-center block",children:["Detail Pengunjung ",t+1]}),e.jsx(U,{index:t,ticketID:u.id,samakanDataPembeli:s})]}),e.jsxs("div",{className:"p-5 flex flex-col gap-4",children:[e.jsx(R,{ticket:u}),e.jsx(v,{id:`email-pengunjung-${t}`,type:"email",name:"email",title:"Email",handleChange:r,value:(o=a[t])==null?void 0:o.email,userType:"pengunjung",index:t,ticketID:u.id,error:m[`data_pengunjung.${t}.email`]}),e.jsx(v,{id:`name-pengunjung-${t}`,type:"text",name:"name",title:"Nama",userType:"pengunjung",handleChange:r,value:(d=a[t])==null?void 0:d.name,index:t,ticketID:u.id,error:m[`data_pengunjung.${t}.name`]}),e.jsx(P,{date:(p=a[t])==null?void 0:p.date,month:(n=a[t])==null?void 0:n.month,year:(g=a[t])==null?void 0:g.year,handleChange:r,index:t,ticketID:u.id,userType:"pengunjung",error:{date:m[`data_pengunjung.${t}.date`],month:m[`data_pengunjung.${t}.month`],year:m[`data_pengunjung.${t}.year`]}}),e.jsx(C,{gender:(l=a[t])==null?void 0:l.gender,handleChange:r,userType:"pengunjung",index:t,ticketID:u.id,data_pengunjung:a,name:`gender-${t}`,idMale:`gender-male-${t}`,idFemale:`gender-female-${t}`,error:m[`data_pengunjung.${t}.gender`]}),e.jsx(I,{identity_type:(c=a[t])==null?void 0:c.identity_type,identity_number:(h=a[t])==null?void 0:h.identity_number,handleChange:r,userType:"pengunjung",index:t,ticketID:u.id,error:{identity_type:m[`data_pengunjung.${t}.identity_type`],identity_number:m[`data_pengunjung.${t}.identity_number`]}})]})]},t)})})}function ae({title:i,profile:s,event:a,data_ticket:r}){const m={before:[{url:route("home"),name:"Beranda"},{url:route("event",a.slug),name:a.name},{url:route("event.tickets",a.slug),name:"Pilih Tiket"}],active:i},[u,t]=T.useState(E({expiration_date:r.expiration_time})),o=()=>{const x=setInterval(()=>{const b=E({expiration_date:r.expiration_time});Z(b)<0?($({title:"Waktu pembelian telah habis",text:"Silahkan lakukan pembelian ulang",icon:"warning"}).then(f=>{f.isConfirmed&&(window.location.href=route("event.tickets",a.slug))}),clearInterval(x)):t(b)},1e3);return()=>clearInterval(x)},{notification:d}=M().props,p=S();T.useEffect(()=>{o(),d&&(d.showConfirmation?W({title:d.title,text:d.text,icon:d.icon,onConfirm:()=>{p.put(route("ticket.clear-session-data-ticket",a.slug))}}):$({title:d.title,text:d.text,icon:d.icon})),r.pembeli&&g("data_pembeli",r.pembeli),r.pengunjung&&g("data_pengunjung",r.pengunjung)},[r,d]);const{data:n,setData:g,post:l,processing:c,errors:h}=S({data_pengunjung:r.tickets.map(()=>({name:"",email:"",year:"",month:"",date:"",gender:"",identity_type:"",identity_number:""})),data_pembeli:{email:s.email,name:s.name,date:N(s.date_of_birth,"day"),month:N(s.date_of_birth,"month"),year:N(s.date_of_birth,"year"),gender:s.gender,identity_type:s.identity_type,identity_number:s.identity_number},sub_total:r.sub_total,tax:r.tax,tax_amount:r.tax_amount,total:r.total}),k=(x,b,f=null,y=null,w=null)=>{let j;w?j=w:j=x.target.name;const D=x.target.value;if(b=="data_pembeli")g("data_pembeli",{...n.data_pembeli,[j]:D});else{const _=[...n.data_pengunjung];_[f]={..._[f],ticket_id:y,[j]:D},g("data_pengunjung",_)}},F=(x,b,f)=>{const y=[...n.data_pengunjung];x.target.checked?y[b]={...y[b],ticket_id:f,email:n.data_pembeli.email,name:n.data_pembeli.name,date:n.data_pembeli.date,month:n.data_pembeli.month,year:n.data_pembeli.year,gender:n.data_pembeli.gender,identity_type:n.data_pembeli.identity_type,identity_number:n.data_pembeli.identity_number}:y[b]={...y[b],ticket_id:null,email:"",name:"",date:"",month:"",year:"",gender:"",identity_type:"",identity_number:""},g("data_pengunjung",y)},B=async x=>{x.preventDefault(),l(route("event.save-data-diri",a.slug),{onError:b=>{setTimeout(()=>{const f=document.querySelector(".error-field");f&&f.scrollIntoView({behavior:"smooth",block:"center"})},100)}})};return e.jsxs(K,{title:"Detail Event",children:[e.jsx(A,{breadCrumbData:m}),e.jsx("form",{action:"",onSubmit:B,children:e.jsxs("div",{className:"mt-8 grid grid-cols-12 gap-8 min-h-[80vh]",children:[e.jsxs("div",{className:"col-span-8 h-fit flex flex-col gap-5",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 text-sm text-yellow-800 border border-yellow-300 rounded-lg bg-yellow-50 ",role:"alert",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"flex-shrink-0 inline w-4 h-4 me-3","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"})}),e.jsx("span",{className:"sr-only",children:"Info"}),e.jsx("div",{className:"",children:e.jsx("span",{className:"font-medium",children:"Batas Waktu Pengisian Data"})})]}),e.jsx("div",{className:"",children:e.jsx("span",{className:"poppins-semibold",children:u})})]}),e.jsx(q,{data_pembeli:n.data_pembeli,handleChange:k,errors:h}),e.jsx(G,{data_pengunjung:n.data_pengunjung,handleChange:k,tickets:r.tickets,samakanDataPembeli:F,errors:h})]}),e.jsx("div",{className:"col-span-4 h-fit  bg-white border border-teal-700 shadow-md rounded-md",children:e.jsx(H,{processing:c,event:a,subTotal:r.sub_total,ticketCount:r.tickets.length,tax:r.tax,taxAmount:r.tax_amount,total:r.total})})]})})]})}export{ae as default};
