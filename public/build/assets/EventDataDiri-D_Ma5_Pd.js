import{j as e,r as E,W as j,q as B}from"./app-5MWagu1p.js";import{B as H}from"./BreadCrumb-J-9IZ_BR.js";import{f as K,E as L}from"./EventDetailPanel-DQAwUNlh.js";import{U as A}from"./UserLayout-C00VADnO.js";import{g as P}from"./getDistance-Dm5tcyCK.js";import{N as T}from"./notification-hbyfIv5m.js";import{s as R}from"./showConfirmation-Dvs7K4RM.js";import{t as W}from"./timeToSeconds-hLgWVabV.js";import"./sweetalert2.esm.all-D3pEHXw3.js";function _({type:l,id:s,name:n,value:a,handleChange:m,title:d,userType:t,index:u=null,ticketID:c=null,error:o=null}){const i=r=>{t==="pembeli"?m(r,"data_pembeli"):m(r,"data_pengunjung",u,c)},g=()=>o?"border border-red-500 focus:border-red-500 focus:ring-0 error-field":"border border-gray-300 focus:ring-teal-500 focus:border-teal-500";return e.jsxs("div",{children:[e.jsx("label",{htmlFor:s,className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:d}),e.jsx("input",{type:l,id:s,name:n,value:a,onChange:r=>i(r),className:`${g()} text-gray-900 text-sm rounded-lg block w-full p-2.5`}),l==="email"&&s==="email"&&e.jsx("span",{className:"text-xs poppins-medium text-teal-700 mt-2 block",children:"Email ini digunakan untuk mengirim E-Ticket"}),o&&e.jsx("span",{className:"text-sm poppins-medium text-red-600 mt-2 block",children:o})]})}function I({gender:l,handleChange:s,index:n=null,ticketID:a=null,userType:m,name:d,idFemale:t,idMale:u,error:c=null}){const o=r=>{m==="pembeli"?s(r,"data_pembeli"):s(r,"data_pengunjung",n,a,"gender")},i=()=>c?"border border-red-500 error-field":"border border-gray-300",g=r=>l===r;return e.jsxs("div",{children:[e.jsx("label",{htmlFor:"gender",className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:"Jenis Kelamin"}),e.jsxs("div",{className:"grid grid-cols-2 gap-5",children:[e.jsxs("div",{className:`flex items-center ps-4 rounded ${i()}`,children:[e.jsx("input",{id:u,type:"radio",value:"Laki-laki",name:d,checked:g("Laki-laki"),onChange:r=>o(r),className:"w-4 h-4 text-teal-600 bg-gray-100 border-gray-300 focus:ring-teal-500 dark:focus:ring-teal-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"}),e.jsx("label",{htmlFor:u,className:"w-full py-4 ms-2 text-sm font-medium text-gray-900 dark:text-gray-300",children:"Laki-laki"})]}),e.jsxs("div",{className:`flex items-center ps-4 rounded ${i()}`,children:[e.jsx("input",{id:t,type:"radio",value:"Perempuan",name:d,checked:g("Perempuan"),onChange:r=>o(r),className:"w-4 h-4 text-teal-600 bg-gray-100 border-gray-300 focus:ring-teal-500 dark:focus:ring-teal-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"}),e.jsx("label",{htmlFor:t,className:"w-full py-4 ms-2 text-sm font-medium text-gray-900 dark:text-gray-300",children:"Perempuan"})]})]}),c&&e.jsx("span",{className:"text-sm text-red-600 block mt-2",children:c})]})}function $({identity_type:l,identity_number:s,handleChange:n,userType:a,index:m=null,ticketID:d=null,error:t={identity_type:null,identity_number:null}}){const u=i=>{a==="pembeli"?n(i,"data_pembeli"):n(i,"data_pengunjung",m,d)},c=()=>t.identity_type?"border border-red-500 focus:border-red-500 focus:ring-0 error-field":"border border-gray-300 focus:ring-teal-500 focus:border-teal-500",o=()=>t.identity_number?"border border-red-500 focus:border-red-500 focus:ring-0 error-field":"border border-gray-300 focus:ring-teal-500 focus:border-teal-500";return e.jsxs("div",{children:[e.jsx("label",{htmlFor:"identity-type",className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:"Nomor Identitas"}),e.jsxs("div",{className:"flex mb-2",children:[e.jsxs("select",{id:"identity-type",name:"identity_type",value:l,onChange:i=>u(i),className:`poppins-medium bg-gray-100 rounded-s-lg text-gray-900 text-sm block p-2.5 ${c()}`,children:[e.jsx("option",{value:"",children:"Pilih Identitas"}),e.jsx("option",{value:"KTP",children:"KTP"}),e.jsx("option",{value:"SIM",children:"SIM"}),e.jsx("option",{value:"PASSPORT",children:"Passport"})]}),e.jsx("input",{type:"number",id:"identity-number",name:"identity_number",value:s,onChange:i=>u(i),className:`poppins-medium bg-gray-50 w-full text-gray-900 text-sm block p-2.5 ${o()}`})]}),t.identity_number&&e.jsx("p",{className:"text-sm text-red-600",children:t.identity_number}),t.identity_type&&e.jsx("p",{className:"text-sm text-red-600",children:t.identity_type})]})}function Z({data_pembeli:l,handleChange:s,errors:n}){return e.jsxs("div",{className:"border border-teal-700 text-white rounded-md shadow-md overflow-hidden",children:[e.jsx("div",{className:"p-5 bg-gradient-to-r from-teal-400 to-teal-500",children:e.jsx("span",{className:"text-center block",children:"Detail Pembeli"})}),e.jsxs("div",{className:"p-5 flex flex-col gap-4",children:[e.jsx(_,{id:"email",type:"email",name:"email",value:l.email,title:"Email",handleChange:s,userType:"pembeli",error:n["data_pembeli.email"]}),e.jsx(_,{id:"name",type:"text",name:"name",value:l.name,title:"Nama",handleChange:s,userType:"pembeli",error:n["data_pembeli.name"]}),e.jsx(I,{gender:l.gender,handleChange:s,name:"gender",userType:"pembeli",idFemale:"gender-female",idMale:"gender-male",error:n["data_pembeli.gender"]}),e.jsx($,{identity_type:l.identity_type,identity_number:l.identity_number,handleChange:s,userType:"pembeli",error:{identity_type:n["data_pembeli.identity_type"],identity_number:n["data_pembeli.identity_number"]}})]})]})}function q({ticket:l}){return e.jsxs("div",{className:"bg-gray-50 p-4 border border-teal-700 flex justify-between items-center rounded-md shadow-md",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h1",{className:"text-gray-500 text-sm poppins-medium",children:"Kategori Tiket"}),e.jsx("span",{className:"text-black poppins-medium mt-[3px]",children:l.name})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h1",{className:"text-gray-500 text-sm poppins-medium text-right",children:"Harga"}),e.jsx("span",{className:"text-black poppins-medium mt-[3px]",children:K(l.price)})]})]})}function U({index:l,ticketID:s,samakanDataPembeli:n}){return e.jsx("span",{className:"text-center block",children:e.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",value:"",className:"sr-only peer samakan-data-pembeli",name:`samakan-data-pembeli[${l}]`,onChange:a=>n(a,l,s)}),e.jsx("div",{className:"shadow-md relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-teal-300 dark:peer-focus:ring-teal-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:w-5 after:h-5 after:transition-all dark:border-gray-600 peer-checked:bg-teal-600"}),e.jsx("span",{className:"ms-3 text-sm font-medium text-white dark:text-gray-300",children:"Samakan dengan data pembeli"})]})})}function G({tickets:l,samakanDataPembeli:s,data_pengunjung:n,handleChange:a,errors:m}){return e.jsx(e.Fragment,{children:l.map((d,t)=>{var u,c,o,i,g;return e.jsxs("div",{className:"border border-teal-700 text-white rounded-md shadow-md overflow-hidden pengunjung",children:[e.jsxs("div",{className:"p-5 flex justify-between items-center bg-gradient-to-r from-teal-400 to-teal-500",children:[e.jsxs("span",{className:"text-center block",children:["Detail Pengunjung ",t+1]}),e.jsx(U,{index:t,ticketID:d.id,samakanDataPembeli:s})]}),e.jsxs("div",{className:"p-5 flex flex-col gap-4",children:[e.jsx(q,{ticket:d}),e.jsx(_,{id:`email-pengunjung-${t}`,type:"email",name:"email",title:"Email",handleChange:a,value:(u=n[t])==null?void 0:u.email,userType:"pengunjung",index:t,ticketID:d.id,error:m[`data_pengunjung.${t}.email`]}),e.jsx(_,{id:`name-pengunjung-${t}`,type:"text",name:"name",title:"Nama",userType:"pengunjung",handleChange:a,value:(c=n[t])==null?void 0:c.name,index:t,ticketID:d.id,error:m[`data_pengunjung.${t}.name`]}),e.jsx(I,{gender:(o=n[t])==null?void 0:o.gender,handleChange:a,userType:"pengunjung",index:t,ticketID:d.id,data_pengunjung:n,name:`gender-${t}`,idMale:`gender-male-${t}`,idFemale:`gender-female-${t}`,error:m[`data_pengunjung.${t}.gender`]}),e.jsx($,{identity_type:(i=n[t])==null?void 0:i.identity_type,identity_number:(g=n[t])==null?void 0:g.identity_number,handleChange:a,userType:"pengunjung",index:t,ticketID:d.id,error:{identity_type:m[`data_pengunjung.${t}.identity_type`],identity_number:m[`data_pengunjung.${t}.identity_number`]}})]})]},t)})})}function ae({title:l,profile:s,event:n,data_ticket:a}){const m={before:[{url:route("home"),name:"Beranda"},{url:route("event",n.slug),name:n.name},{url:route("event.tickets",n.slug),name:"Pilih Tiket"}],active:l},[d,t]=E.useState(P({expiration_date:a.expiration_time})),u=j(),c=j(),o=()=>{const b=setInterval(()=>{const p=P({expiration_date:a.expiration_time});W(p)<0?(T({title:"Waktu pembelian telah habis",text:"Silahkan lakukan pembelian ulang",icon:"warning"}).then(x=>{x.isConfirmed&&u.put(route("ticket.clear-session-data-ticket",n.slug),{onSuccess:()=>{c.get(route("event.tickets",n.slug))}})}),clearInterval(b)):t(p)},1e3);return()=>clearInterval(b)},{notification:i}=B().props,g=j();E.useEffect(()=>{o(),i&&(i.showConfirmation?R({title:i.title,text:i.text,icon:i.icon,onConfirm:()=>{g.put(route("ticket.clear-session-data-ticket",n.slug))}}):T({title:i.title,text:i.text,icon:i.icon})),a.pembeli&&y("data_pembeli",a.pembeli),a.pengunjung&&y("data_pengunjung",a.pengunjung)},[a,i]);const{data:r,setData:y,post:C,processing:S,errors:k}=j({data_pengunjung:a.tickets.map(()=>({name:"",email:"",gender:"",identity_type:"",identity_number:""})),data_pembeli:{email:s.email,name:s.name,gender:s.gender,identity_type:s.identity_type,identity_number:s.identity_number},sub_total:a.sub_total,tax:a.tax,tax_amount:a.tax_amount,total:a.total}),N=(b,p,x=null,f=null,w=null)=>{let h;w?h=w:h=b.target.name;const D=b.target.value;if(p=="data_pembeli")y("data_pembeli",{...r.data_pembeli,[h]:D});else{const v=[...r.data_pengunjung];v[x]={...v[x],ticket_id:f,[h]:D},y("data_pengunjung",v)}},F=(b,p,x)=>{const f=[...r.data_pengunjung];b.target.checked?f[p]={...f[p],ticket_id:x,email:r.data_pembeli.email,name:r.data_pembeli.name,date:r.data_pembeli.date,month:r.data_pembeli.month,year:r.data_pembeli.year,gender:r.data_pembeli.gender,identity_type:r.data_pembeli.identity_type,identity_number:r.data_pembeli.identity_number}:f[p]={...f[p],ticket_id:null,email:"",name:"",date:"",month:"",year:"",gender:"",identity_type:"",identity_number:""},y("data_pengunjung",f)},M=async b=>{b.preventDefault(),C(route("event.save-data-diri",n.slug),{onError:p=>{setTimeout(()=>{const x=document.querySelector(".error-field");x&&x.scrollIntoView({behavior:"smooth",block:"center"})},100)}})};return e.jsxs(A,{title:"Detail Event",children:[e.jsx(H,{breadCrumbData:m}),e.jsx("form",{action:"",onSubmit:M,children:e.jsxs("div",{className:"mt-8 grid grid-cols-12 gap-8 min-h-[80vh]",children:[e.jsxs("div",{className:"col-span-8 h-fit flex flex-col gap-5",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 text-sm text-yellow-800 border border-yellow-300 rounded-lg bg-yellow-50 ",role:"alert",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"flex-shrink-0 inline w-4 h-4 me-3","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"})}),e.jsx("span",{className:"sr-only",children:"Info"}),e.jsx("div",{className:"",children:e.jsx("span",{className:"font-medium",children:"Batas Waktu Pengisian Data"})})]}),e.jsx("div",{className:"",children:e.jsx("span",{className:"poppins-semibold",children:d})})]}),e.jsx(Z,{data_pembeli:r.data_pembeli,handleChange:N,errors:k}),e.jsx(G,{data_pengunjung:r.data_pengunjung,handleChange:N,tickets:a.tickets,samakanDataPembeli:F,errors:k})]}),e.jsx("div",{className:"col-span-4 h-fit  bg-white border border-teal-700 shadow-md rounded-md",children:e.jsx(L,{processing:S,event:n,subTotal:a.sub_total,ticketCount:a.tickets.length,tax:a.tax,taxAmount:a.tax_amount,internetFee:a.internet_fee,total:a.total})})]})})]})}export{ae as default};
