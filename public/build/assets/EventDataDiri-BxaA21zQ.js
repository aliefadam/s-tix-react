import{j as e,r as E,W as v,q as L}from"./app-Cd7ZNo18.js";import{B as H}from"./BreadCrumb-DzjuUnDI.js";import{f as K,E as R}from"./EventDetailPanel-CaGVFFtS.js";import{U as W}from"./UserLayout-rfh2apWa.js";import{g as k}from"./getDatePart-HgEJ48wy.js";import{g as $}from"./getDistance-Dm5tcyCK.js";import{N as P}from"./notification-D8nuFN0y.js";import{s as Z}from"./showConfirmation-2MnBgizT.js";import{t as q}from"./timeToSeconds-hLgWVabV.js";function _({type:s,id:l,name:r,value:n,handleChange:m,title:u,userType:t,index:d=null,ticketID:c=null,error:p=null}){const i=a=>{t==="pembeli"?m(a,"data_pembeli"):m(a,"data_pengunjung",d,c)},g=()=>p?"border border-red-500 focus:border-red-500 focus:ring-0 error-field":"border border-gray-300 focus:ring-teal-500 focus:border-teal-500";return e.jsxs("div",{children:[e.jsx("label",{htmlFor:l,className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:u}),e.jsx("input",{type:s,id:l,name:r,value:n,onChange:a=>i(a),className:`${g()} text-gray-900 text-sm rounded-lg block w-full p-2.5`}),s==="email"&&l==="email"&&e.jsx("span",{className:"text-xs poppins-medium text-teal-700 mt-2 block",children:"Email ini digunakan untuk mengirim E-Ticket"}),p&&e.jsx("span",{className:"text-sm poppins-medium text-red-600 mt-2 block",children:p})]})}function C({date:s,month:l,year:r,handleChange:n,userType:m,index:u=null,ticketID:t=null,error:d={date:null,month:null,year:null}}){const c=a=>{m==="pembeli"?n(a,"data_pembeli"):n(a,"data_pengunjung",u,t)},p=()=>d.date?"border border-red-500 focus:border-red-500 focus:ring-0 error-field":"border border-gray-300 focus:ring-teal-500 focus:border-teal-500",i=()=>d.month?"border border-red-500 focus:border-red-500 focus:ring-0 error-field":"border border-gray-300 focus:ring-teal-500 focus:border-teal-500",g=()=>d.year?"border border-red-500 focus:border-red-500 focus:ring-0 error-field":"border border-gray-300 focus:ring-teal-500 focus:border-teal-500";return e.jsxs("div",{children:[e.jsx("label",{htmlFor:"date",className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:"Tanggal Lahir"}),e.jsxs("div",{className:"grid grid-cols-3 gap-5",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("select",{id:"date",name:"date",value:s,onChange:a=>c(a),className:`bg-gray-50 text-gray-900 text-sm rounded-lg  block w-full p-2.5 ${p()}`,children:[e.jsx("option",{value:"",children:"Tanggal"}),Array.from({length:31},(a,o)=>e.jsx("option",{value:String(o+1).padStart(2,"0"),children:String(o+1).padStart(2,"0")},o))]}),d.date&&e.jsx("p",{className:"text-red-600 text-sm",children:d.date})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("select",{id:"month",name:"month",value:l,onChange:a=>c(a),className:`h-fit bg-gray-50 text-gray-900 text-sm rounded-lg  block w-full p-2.5 ${i()}`,children:[e.jsx("option",{value:"",children:"Bulan"}),Array.from({length:12},(a,o)=>e.jsx("option",{value:String(o+1).padStart(2,"0"),children:String(o+1).padStart(2,"0")},o))]}),d.month&&e.jsx("p",{className:"text-red-600 text-sm",children:d.month})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("select",{id:"year",name:"year",value:r,onChange:a=>c(a),className:`h-fit bg-gray-50 text-gray-900 text-sm rounded-lg  block w-full p-2.5 ${g()}`,children:[e.jsx("option",{value:"",children:"Tahun"}),Array.from({length:100},(a,o)=>e.jsx("option",{value:String(2024-o),children:2024-o},o))]}),d.year&&e.jsx("p",{className:"text-red-600 text-sm",children:d.year})]})]})]})}function I({gender:s,handleChange:l,index:r=null,ticketID:n=null,userType:m,name:u,idFemale:t,idMale:d,error:c=null}){const p=a=>{m==="pembeli"?l(a,"data_pembeli"):l(a,"data_pengunjung",r,n,"gender")},i=()=>c?"border border-red-500 error-field":"border border-gray-300",g=a=>s===a;return e.jsxs("div",{children:[e.jsx("label",{htmlFor:"gender",className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:"Jenis Kelamin"}),e.jsxs("div",{className:"grid grid-cols-2 gap-5",children:[e.jsxs("div",{className:`flex items-center ps-4 rounded ${i()}`,children:[e.jsx("input",{id:d,type:"radio",value:"Laki-laki",name:u,checked:g("Laki-laki"),onChange:a=>p(a),className:"w-4 h-4 text-teal-600 bg-gray-100 border-gray-300 focus:ring-teal-500 dark:focus:ring-teal-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"}),e.jsx("label",{htmlFor:d,className:"w-full py-4 ms-2 text-sm font-medium text-gray-900 dark:text-gray-300",children:"Laki-laki"})]}),e.jsxs("div",{className:`flex items-center ps-4 rounded ${i()}`,children:[e.jsx("input",{id:t,type:"radio",value:"Perempuan",name:u,checked:g("Perempuan"),onChange:a=>p(a),className:"w-4 h-4 text-teal-600 bg-gray-100 border-gray-300 focus:ring-teal-500 dark:focus:ring-teal-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"}),e.jsx("label",{htmlFor:t,className:"w-full py-4 ms-2 text-sm font-medium text-gray-900 dark:text-gray-300",children:"Perempuan"})]})]}),c&&e.jsx("span",{className:"text-sm text-red-600 block mt-2",children:c})]})}function F({identity_type:s,identity_number:l,handleChange:r,userType:n,index:m=null,ticketID:u=null,error:t={identity_type:null,identity_number:null}}){const d=i=>{n==="pembeli"?r(i,"data_pembeli"):r(i,"data_pengunjung",m,u)},c=()=>t.identity_type?"border border-red-500 focus:border-red-500 focus:ring-0 error-field":"border border-gray-300 focus:ring-teal-500 focus:border-teal-500",p=()=>t.identity_number?"border border-red-500 focus:border-red-500 focus:ring-0 error-field":"border border-gray-300 focus:ring-teal-500 focus:border-teal-500";return e.jsxs("div",{children:[e.jsx("label",{htmlFor:"identity-type",className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:"Nomor Identitas"}),e.jsxs("div",{className:"flex mb-2",children:[e.jsxs("select",{id:"identity-type",name:"identity_type",value:s,onChange:i=>d(i),className:`poppins-medium bg-gray-100 rounded-s-lg text-gray-900 text-sm block p-2.5 ${c()}`,children:[e.jsx("option",{value:"",children:"Pilih Identitas"}),e.jsx("option",{value:"KTP",children:"KTP"}),e.jsx("option",{value:"SIM",children:"SIM"}),e.jsx("option",{value:"PASSPORT",children:"Passport"})]}),e.jsx("input",{type:"number",id:"identity-number",name:"identity_number",value:l,onChange:i=>d(i),className:`poppins-medium bg-gray-50 w-full text-gray-900 text-sm block p-2.5 ${p()}`})]}),t.identity_number&&e.jsx("p",{className:"text-sm text-red-600",children:t.identity_number}),t.identity_type&&e.jsx("p",{className:"text-sm text-red-600",children:t.identity_type})]})}function U({data_pembeli:s,handleChange:l,errors:r}){return e.jsxs("div",{className:"border border-teal-700 text-white rounded-md shadow-md overflow-hidden",children:[e.jsx("div",{className:"p-5 bg-gradient-to-r from-teal-400 to-teal-500",children:e.jsx("span",{className:"text-center block",children:"Detail Pembeli"})}),e.jsxs("div",{className:"p-5 flex flex-col gap-4",children:[e.jsx(_,{id:"email",type:"email",name:"email",value:s.email,title:"Email",handleChange:l,userType:"pembeli",error:r["data_pembeli.email"]}),e.jsx(_,{id:"name",type:"text",name:"name",value:s.name,title:"Nama",handleChange:l,userType:"pembeli",error:r["data_pembeli.name"]}),e.jsx(C,{date:s.date,month:s.month,year:s.year,handleChange:l,userType:"pembeli",error:{date:r["data_pembeli.date"],month:r["data_pembeli.month"],year:r["data_pembeli.year"]}}),e.jsx(I,{gender:s.gender,handleChange:l,name:"gender",userType:"pembeli",idFemale:"gender-female",idMale:"gender-male",error:r["data_pembeli.gender"]}),e.jsx(F,{identity_type:s.identity_type,identity_number:s.identity_number,handleChange:l,userType:"pembeli",error:{identity_type:r["data_pembeli.identity_type"],identity_number:r["data_pembeli.identity_number"]}})]})]})}function G({ticket:s}){return e.jsxs("div",{className:"bg-gray-50 p-4 border border-teal-700 flex justify-between items-center rounded-md shadow-md",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h1",{className:"text-gray-500 text-sm poppins-medium",children:"Kategori Tiket"}),e.jsx("span",{className:"text-black poppins-medium mt-[3px]",children:s.name})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h1",{className:"text-gray-500 text-sm poppins-medium text-right",children:"Harga"}),e.jsx("span",{className:"text-black poppins-medium mt-[3px]",children:K(s.price)})]})]})}function J({index:s,ticketID:l,samakanDataPembeli:r}){return e.jsx("span",{className:"text-center block",children:e.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",value:"",className:"sr-only peer samakan-data-pembeli",name:`samakan-data-pembeli[${s}]`,onChange:n=>r(n,s,l)}),e.jsx("div",{className:"shadow-md relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-teal-300 dark:peer-focus:ring-teal-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:w-5 after:h-5 after:transition-all dark:border-gray-600 peer-checked:bg-teal-600"}),e.jsx("span",{className:"ms-3 text-sm font-medium text-white dark:text-gray-300",children:"Samakan dengan data pembeli"})]})})}function O({tickets:s,samakanDataPembeli:l,data_pengunjung:r,handleChange:n,errors:m}){return e.jsx(e.Fragment,{children:s.map((u,t)=>{var d,c,p,i,g,a,o,h;return e.jsxs("div",{className:"border border-teal-700 text-white rounded-md shadow-md overflow-hidden pengunjung",children:[e.jsxs("div",{className:"p-5 flex justify-between items-center bg-gradient-to-r from-teal-400 to-teal-500",children:[e.jsxs("span",{className:"text-center block",children:["Detail Pengunjung ",t+1]}),e.jsx(J,{index:t,ticketID:u.id,samakanDataPembeli:l})]}),e.jsxs("div",{className:"p-5 flex flex-col gap-4",children:[e.jsx(G,{ticket:u}),e.jsx(_,{id:`email-pengunjung-${t}`,type:"email",name:"email",title:"Email",handleChange:n,value:(d=r[t])==null?void 0:d.email,userType:"pengunjung",index:t,ticketID:u.id,error:m[`data_pengunjung.${t}.email`]}),e.jsx(_,{id:`name-pengunjung-${t}`,type:"text",name:"name",title:"Nama",userType:"pengunjung",handleChange:n,value:(c=r[t])==null?void 0:c.name,index:t,ticketID:u.id,error:m[`data_pengunjung.${t}.name`]}),e.jsx(C,{date:(p=r[t])==null?void 0:p.date,month:(i=r[t])==null?void 0:i.month,year:(g=r[t])==null?void 0:g.year,handleChange:n,index:t,ticketID:u.id,userType:"pengunjung",error:{date:m[`data_pengunjung.${t}.date`],month:m[`data_pengunjung.${t}.month`],year:m[`data_pengunjung.${t}.year`]}}),e.jsx(I,{gender:(a=r[t])==null?void 0:a.gender,handleChange:n,userType:"pengunjung",index:t,ticketID:u.id,data_pengunjung:r,name:`gender-${t}`,idMale:`gender-male-${t}`,idFemale:`gender-female-${t}`,error:m[`data_pengunjung.${t}.gender`]}),e.jsx(F,{identity_type:(o=r[t])==null?void 0:o.identity_type,identity_number:(h=r[t])==null?void 0:h.identity_number,handleChange:n,userType:"pengunjung",index:t,ticketID:u.id,error:{identity_type:m[`data_pengunjung.${t}.identity_type`],identity_number:m[`data_pengunjung.${t}.identity_number`]}})]})]},t)})})}function ne({title:s,profile:l,event:r,data_ticket:n}){const m={before:[{url:route("home"),name:"Beranda"},{url:route("event",r.slug),name:r.name},{url:route("event.tickets",r.slug),name:"Pilih Tiket"}],active:s},[u,t]=E.useState($({expiration_date:n.expiration_time})),d=v(),c=v(),p=()=>{const x=setInterval(()=>{const b=$({expiration_date:n.expiration_time});q(b)<0?(P({title:"Waktu pembelian telah habis",text:"Silahkan lakukan pembelian ulang",icon:"warning"}).then(f=>{f.isConfirmed&&d.put(route("ticket.clear-session-data-ticket",r.slug),{onSuccess:()=>{c.get(route("event.tickets",r.slug))}})}),clearInterval(x)):t(b)},1e3);return()=>clearInterval(x)},{notification:i}=L().props,g=v();E.useEffect(()=>{p(),i&&(i.showConfirmation?Z({title:i.title,text:i.text,icon:i.icon,onConfirm:()=>{g.put(route("ticket.clear-session-data-ticket",r.slug))}}):P({title:i.title,text:i.text,icon:i.icon})),n.pembeli&&o("data_pembeli",n.pembeli),n.pengunjung&&o("data_pengunjung",n.pengunjung)},[n,i]);const{data:a,setData:o,post:h,processing:B,errors:w}=v({data_pengunjung:n.tickets.map(()=>({name:"",email:"",year:"",month:"",date:"",gender:"",identity_type:"",identity_number:""})),data_pembeli:{email:l.email,name:l.name,date:k(l.date_of_birth,"day"),month:k(l.date_of_birth,"month"),year:k(l.date_of_birth,"year"),gender:l.gender,identity_type:l.identity_type,identity_number:l.identity_number},sub_total:n.sub_total,tax:n.tax,tax_amount:n.tax_amount,total:n.total}),D=(x,b,f=null,y=null,S=null)=>{let j;S?j=S:j=x.target.name;const T=x.target.value;if(b=="data_pembeli")o("data_pembeli",{...a.data_pembeli,[j]:T});else{const N=[...a.data_pengunjung];N[f]={...N[f],ticket_id:y,[j]:T},o("data_pengunjung",N)}},M=(x,b,f)=>{const y=[...a.data_pengunjung];x.target.checked?y[b]={...y[b],ticket_id:f,email:a.data_pembeli.email,name:a.data_pembeli.name,date:a.data_pembeli.date,month:a.data_pembeli.month,year:a.data_pembeli.year,gender:a.data_pembeli.gender,identity_type:a.data_pembeli.identity_type,identity_number:a.data_pembeli.identity_number}:y[b]={...y[b],ticket_id:null,email:"",name:"",date:"",month:"",year:"",gender:"",identity_type:"",identity_number:""},o("data_pengunjung",y)},A=async x=>{x.preventDefault(),h(route("event.save-data-diri",r.slug),{onError:b=>{setTimeout(()=>{const f=document.querySelector(".error-field");f&&f.scrollIntoView({behavior:"smooth",block:"center"})},100)}})};return e.jsxs(W,{title:"Detail Event",children:[e.jsx(H,{breadCrumbData:m}),e.jsx("form",{action:"",onSubmit:A,children:e.jsxs("div",{className:"mt-8 grid grid-cols-12 gap-8 min-h-[80vh]",children:[e.jsxs("div",{className:"col-span-8 h-fit flex flex-col gap-5",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 text-sm text-yellow-800 border border-yellow-300 rounded-lg bg-yellow-50 ",role:"alert",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"flex-shrink-0 inline w-4 h-4 me-3","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"})}),e.jsx("span",{className:"sr-only",children:"Info"}),e.jsx("div",{className:"",children:e.jsx("span",{className:"font-medium",children:"Batas Waktu Pengisian Data"})})]}),e.jsx("div",{className:"",children:e.jsx("span",{className:"poppins-semibold",children:u})})]}),e.jsx(U,{data_pembeli:a.data_pembeli,handleChange:D,errors:w}),e.jsx(O,{data_pengunjung:a.data_pengunjung,handleChange:D,tickets:n.tickets,samakanDataPembeli:M,errors:w})]}),e.jsx("div",{className:"col-span-4 h-fit  bg-white border border-teal-700 shadow-md rounded-md",children:e.jsx(R,{processing:B,event:r,subTotal:n.sub_total,ticketCount:n.tickets.length,tax:n.tax,taxAmount:n.tax_amount,total:n.total})})]})})]})}export{ne as default};
